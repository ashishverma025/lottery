{% extends 'header.html' %}
{% load static %}
{% block title %}:: Self Reported Questions Two ::{% endblock %}
{% block content %}
<div class="sectionp1 top-padding margin tm">
    <div class="containerp1 w-container">
        <!-- Horizontal Steppers -->
        <section class="signup-step-container step-wizard-bar">
            <div class="row d-flex justify-content-center">
                <div class="col-md-12">
                    <div class="wizard alpaca-wizard">
                        <form role="form" class="login-box" id="selfReportedQuestionsForm">
                            <input type="hidden" value="1" id="answerCount">

                            <div class="tab-content" id="main_form">
                                <div class="tab-pane active" role="tabpanel" id="step1">
                                    <div class="wizardTab">
                                        <div class="holder">
                                            <div class="title">Help us understand your debt situation</div>
                                            <div class="description">
                                                <p class="paragraph-p5 centre">Specify total medical, credit card,  car loan, and personal/payday loans you currently owe. If you do not owe any of these debts, go to next step. 
                                                </p>
                                            </div>
                                        </div>
                                        <div class="addMoreFields">
                                            <div class="row">
                                                <div  class="col-md-12">
                                                    <div class="alpaca-container-item-full mt-5 text-center form-inline-full ">
                                                        <!--- repeted row--->
                                                        <div class="form-row">
                                                            <div class="form-group col-md-4">
                                                                <div class="control-label">
                                                                    <label class="col-form-label labeltxt">Lender Name</label>
                                                                </div>
                                                                <input type="text" name="lender_name[]" class="boxes form-control landername setval1" data-num="1" placeholder="" style="position: relative;z-index: 1;">
                                                                <ul class="mylist1 lenderList"></ul>
                                                            </div>
                                                            <div class="form-group col-md-4">
                                                                <div class="control-label">
                                                                    <label class="col-form-label labeltxt">Loan Type </label>
                                                                </div>

                                                                <select name="loan_type[]" class="form-control boxes">
                                                                    <option value=""></option>
                                                                    <option value="Auto Loan">Auto Loan</option>
                                                                    <option value="Payday/Personal Loan">Payday/Personal Loan</option>
                                                                    <option value="Credit Card">Credit Card</option>
                                                                    <option value="Medical Dept">Medical Dept</option>
                                                                    <option value="Other">Other</option>
                                                                </select>
                                                                <!-- <input type="text" name="loan_type[]" class="form-control boxes" placeholder=""> -->
                                                            </div>
                                                            <div class="form-group col-md-4">
                                                                <div class="control-label">
                                                                    <label class="col-form-label labeltxt ">Remaining Balance?</label>
                                                                </div>
                                                                <input type="text" name="remaining_balance[]" class="form-control boxes" placeholder="">
                                                            </div>
                                                        </div>
                                                        <!--- end repeted row--->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row text-right">
                                            <div class="col-md-12">
                                                <button type="button" class="btn add-btn" id="addmore" style="background-color:transparent;">
                                                    <i class="fas fa-plus"></i> Add
                                                </button>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="wizardTab">
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <div id="address" class="alpaca-container-item text-left">
                                                                <div class="row form-group alpaca-field">
                                                                    <div class="col-md-4">
                                                                        <div class="control-label">
                                                                            <label>Street Address</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-6">
                                                                        <div class="custom-control-form">
                                                                            <input id="autocomplete" onFocus="geolocate()" class="form-control" type="text"  name="address" placeholder="Enter your address"> 
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="row form-group alpaca-field">
                                                                    <div class="col-md-4">
                                                                        <div class="control-label">
                                                                            <label>City</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-6">
                                                                        <div class="custom-control-form">
                                                                            <input class="form-control" type="text" id="locality" disabled="true" name="city" placeholder=""> 
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="row form-group alpaca-field">
                                                                    <div class="col-md-4">
                                                                        <div class="control-label">
                                                                            <label>State</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-6">
                                                                        <div class="custom-control-form">
                                                                            <input class="form-control" name="state" id="administrative_area_level_1" placeholder="" disabled="true"/></td>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="row form-group alpaca-field">
                                                                    <div class="col-md-4">
                                                                        <div class="control-label">
                                                                            <label>Zip</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-6">
                                                                        <div class="custom-control-form">
                                                                            <input class="form-control" id="postal_code" disabled="true" type="text"  name="postal_code" placeholder=""> 
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <ul class="list-inline alpaca-control-buttons-container">
                                <!--  <li><button type="button" class="default-btn prev-step">Back</button></li> --> 
                                <li><button type="button" id="continue" class="default-btn btn next-step">Continue</button></li>
                            </ul>
                        </form>
                    </div>
                </div>

            </div>
    </div>
</div>
</section>
<!-- /.Horizontal Steppers -->
</div>
</div>
{% endblock %}
{% block js_scripts %}

<script>
    var placeSearch, autocomplete;
    var componentForm = {
        // street_number: 'short_name',
        // route: 'long_name',
        locality: 'long_name',
        administrative_area_level_1: 'long_name',
        // country: 'long_name',
        postal_code: 'short_name'
    };

    function initAutocomplete() {
        // Create the autocomplete object, restricting the search predictions to
        // geographical location types.
        autocomplete = new google.maps.places.Autocomplete(
                document.getElementById('autocomplete'), {types: ['geocode']});

        // Avoid paying for data that you don't need by restricting the set of
        // place fields that are returned to just the address components.
        autocomplete.setFields(['address_component']);

        // When the user selects an address from the drop-down, populate the
        // address fields in the form.
        autocomplete.addListener('place_changed', fillInAddress);
    }

    function fillInAddress() {
        // Get the place details from the autocomplete object.
        var place = autocomplete.getPlace();
        document.getElementById('autocomplete').value = '';
        for (var component in componentForm) {
            document.getElementById(component).value = '';
            document.getElementById(component).disabled = false;
        }

        // Get each component of the address from the place details,
        // and then fill-in the corresponding field on the form.
        if (place.address_components[0].types[0] == 'street_number' || place.address_components[1].types[0] == 'route') {
            document.getElementById('autocomplete').value = place.address_components[0].long_name + ', ' + place.address_components[1].long_name;
        }
        for (var i = 0; i < place.address_components.length; i++) {
            var addressType = place.address_components[i].types[0];
            if (componentForm[addressType]) {
                var val = place.address_components[i][componentForm[addressType]];
                document.getElementById(addressType).value = val;
            }
        }
    }

// Bias the autocomplete object to the user's geographical location,
// as supplied by the browser's 'navigator.geolocation' object.
    function geolocate() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                var geolocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                var circle = new google.maps.Circle(
                        {center: geolocation, radius: position.coords.accuracy});
                autocomplete.setBounds(circle.getBounds());
            });
        }
    }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDwjcS0e7q8SdRsZoR8u2w5iSoUnI2NnE0&libraries=places&callback=initAutocomplete"
async defer></script>


<script>
    // ------------step-wizard-------------
    // ------------step-wizard-------------
    $(document).ready(function () {
        $('.nav-tabs > li a[title]').tooltip();

        //Wizard
        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {

            var target = $(e.target);

            if (target.parent().hasClass('disabled')) {
                return false;
            }
        });

        $(".next-step").click(function (e) {

            var active = $('.wizard .nav-tabs li.active');
            active.next().removeClass('disabled');
            nextTab(active);

        });
        $(".prev-step").click(function (e) {

            var active = $('.wizard .nav-tabs li.active');
            prevTab(active);

        });
    });

    function nextTab(elem) {
        $(elem).next().find('a[data-toggle="tab"]').click();
    }
    function prevTab(elem) {
        $(elem).prev().find('a[data-toggle="tab"]').click();
    }


    $('.nav-tabs').on('click', 'li', function () {
        $('.nav-tabs li.active').removeClass('active');
        $(this).addClass('active');
    });

</script>
<!-- Add More functionality -->
<script>
    $(document).on('click', '.listVal', function () {
        var lnum = $(this).attr('set-val');
        $(".setval" + lnum).val($(this).text())
        $('.mylist' + lnum).html('')
        $('.mylist' + lnum).css('max-height', '0px')
    });

    $(document).on('keyup', '.landername', function () {
        var q = $(this).val();
        var lnum = $(this).attr('data-num');
        $('.mylist' + lnum).html('')
        // var data = form.serializeArray();
        if (q != '') {
            $.ajax({
                type: "POST",
                enctype: 'multipart/form-data',
                url: "{% url 'home:csv_reader' %}",
                data: {'q': q},
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
                },
                success: function (data) {
                    console.log(data.result)
                    var cList = $(".mylist" + lnum);
                    $('.mylist' + lnum).css('max-height', '202px')
                    var results = data.result
                    $.each(results, function (i, l) {
                        var li = $('<li/>').addClass('ui-menu-item').attr('role', 'menuitem').appendTo(cList);
                        var aaa = $('<a/>').addClass('ui-all listVal').attr('set-val', lnum).text(results[i]).appendTo(li);
                    });
                },
                error: function (e) {
                    console.log("ERROR : ", e);
                }
            });
        }
    });



    $("#continue").click(function () {
        var form = $("#selfReportedQuestionsForm")[0];
        // var data = form.serializeArray();
        var data = new FormData(form);
        $.ajax({
            type: "POST",
            enctype: 'multipart/form-data',
            url: "{% url 'home:self_reported_questions_two_save' %}",
            data: data,
            processData: false,
            contentType: false,
            beforeSend: function (xhr) {
                xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
            },
            success: function (data) {
                console.log(data)
            },
            error: function (e) {
                console.log("ERROR : ", e);
            }
        });
    });
    $(document).on('click', '.removediv', function () {
        $(this).parent().remove();
    });

    $("#addmore").click(function () {
        var cnt = $("#answerCount").val()
        cnt = parseInt(cnt) + 1

        var str = '<div class="row"><div  class="col-md-12"><div class="alpaca-container-item-full mt-5 text-center form-inline-full "><div class="form-row"><div class="form-group col-md-4"><div class="control-label"><label class="col-form-label labeltxt">Lender Name</label></div><input type="text" class="boxes form-control landername setval' + cnt + '" data-num = "' + cnt + '" placeholder="" name="lender_name[]"><ul class="mylist' + cnt + ' lenderList"></ul></div><div class="form-group col-md-4"><div class="control-label"><label class="col-form-label labeltxt">Loan Type </label></div><select name="loan_type[]" class="form-control boxes"><option value=""></option><option value="Auto Loan">Auto Loan</option><option value="Payday/Personal Loan">Payday/Personal Loan</option><option value="Credit Card">Credit Card</option><option value="Medical Dept">Medical Dept</option><option value="Other">Other</option></select></div><div class="form-group col-md-4"><div class="control-label"><label class="col-form-label labeltxt">Remaining Balance?</label></div><input type="text" class="form-control boxes" placeholder="" name="remaining_balance[]"></div></div></div></div><i class="nav-icon fas fa-trash removediv" style="color:red;"></i></div>'

        $(".addMoreFields").append(str)
        $("#answerCount").val(cnt)
    });
</script>
<script>
    $(document).ready(function () {
        //range Slider /  START
        var $rangeslider = $('#js-amount-range-one');
        var $amount = $('#js-amount-input-one');
        $rangeslider.rangeslider({
            polyfill: false
        })
                .on('input', function () {
                    $amount[0].value = this.value;
                });
        $amount.on('input', function () {
            $rangeslider.val(this.value).change();
        });
        //range Slider / Finance_slider_v1 END


    });
</script>
<script>
    $(document).ready(function () {
        //range Slider /  START
        var $rangeslider = $('#js-amount-range-two');
        var $amount = $('#js-amount-input-two');
        $rangeslider.rangeslider({
            polyfill: false
        })
                .on('input', function () {
                    $amount[0].value = this.value;
                });
        $amount.on('input', function () {
            $rangeslider.val(this.value).change();
        });
        //range Slider / Finance_slider_v1 END


    });
</script>
{% endblock js_scripts %}